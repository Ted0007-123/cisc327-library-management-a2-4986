============================= test session starts =============================
platform win32 -- Python 3.12.10, pytest-7.4.2, pluggy-1.6.0 -- C:\Users\tedch\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main
collecting ... collected 16 items

sample_test.py::test_add_book_valid_input FAILED                         [  6%]
sample_test.py::test_add_book_invalid_isbn_too_short PASSED              [ 12%]
test/test_r1_add_book.py::test_r1_accepts_valid_input PASSED             [ 18%]
test/test_r1_add_book.py::test_r1_rejects_bad_isbn_length PASSED         [ 25%]
test/test_r1_add_book.py::test_r1_rejects_non_positive_total PASSED      [ 31%]
test/test_r2_catalog.py::test_r2_catalog_route_ok PASSED                 [ 37%]
test/test_r3_borrow.py::test_r3_borrow_until_out_of_stock FAILED         [ 43%]
test/test_r4_return.py::test_r4_return_happy_path FAILED                 [ 50%]
test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[0-0.0] FAILED [ 56%]
test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[3-1.5] FAILED [ 62%]
test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[7-3.5] FAILED [ 68%]
test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[10-6.5] FAILED [ 75%]
test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[30-15.0] FAILED [ 81%]
test/test_r6_search.py::test_r6_title_case_insensitive_business_logic FAILED [ 87%]
test/test_r6_search.py::test_r6_api_json_search FAILED                   [ 93%]
test/test_r7_patron_status.py::test_r7_status_report_shape_and_keys FAILED [100%]

================================== FAILURES ===================================
__________________________ test_add_book_valid_input __________________________

    def test_add_book_valid_input():
        """Test adding a book with valid input."""
        success, message = add_book_to_catalog("Test Book", "Test Author", "1234567890123", 5)
    
>       assert success == True
E       assert False == True

sample_test.py:10: AssertionError
______________________ test_r3_borrow_until_out_of_stock ______________________

    @pytest.mark.usefixtures("temp_db")
    def test_r3_borrow_until_out_of_stock():
        """
        R3: Borrow should succeed while copies are available, then fail when none left.
        We add a controlled test book to avoid depending on seed state.
        """
        ok, msg = add_book("Test Borrow", "Author", "1234567890123", 1)
        assert ok
    
        # First borrow (available = 1 -> 0)
        ok1, msg1 = borrow("123456", 1)  # book_id=1 for the first inserted book in an empty DB
        assert ok1 is True, f"first borrow should succeed: {(ok1, msg1)}"
    
        # Second borrow should fail (no copies left)
        ok2, msg2 = borrow("123456", 1)
>       assert ok2 is False, f"second borrow should fail when out of stock: {(ok2, msg2)}"
E       AssertionError: second borrow should fail when out of stock: (True, 'Successfully borrowed "The Great Gatsby". Due date: 2025-09-30.')
E       assert True is False

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r3_borrow.py:23: AssertionError
__________________________ test_r4_return_happy_path __________________________

    @pytest.mark.usefixtures("temp_db")
    def test_r4_return_happy_path():
        """
        R4: Borrow then return should succeed.
        """
        ok, _ = add_book("Returnable", "Auth", "9999999999999", 1)
        assert ok
    
        ok_b, _ = borrow("654321", 1)
        assert ok_b, "borrow must succeed before return"
    
        ok_r, msg_r = ret("654321", 1)
>       assert ok_r is True, f"return should succeed: {(ok_r, msg_r)}"
E       AssertionError: return should succeed: (False, 'Book return functionality is not yet implemented.')
E       assert False is True

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r4_return.py:21: AssertionError
________________ test_r5_fee_formula_via_business_logic[0-0.0] ________________

late_days = 0, expected_fee = 0.0

    @pytest.mark.usefixtures("temp_db")
    @pytest.mark.parametrize("late_days, expected_fee", [
        (0, 0.0),
        (3, 0.5*3),            # first 7 days: $0.50/day
        (7, 0.5*7),            # = $3.50
        (10, 0.5*7 + 1.0*3),   # = $6.50
        (30, 15.0),            # cap at $15
    ])
    def test_r5_fee_formula_via_business_logic(late_days, expected_fee):
        """
        R5: Late fee rules:
          - Overdue after 14 days
          - First 7 overdue days: $0.50/day
          - Afterwards: $1.00/day
          - Cap per book: $15.00
        We simulate a borrow that is overdue by `late_days`.
        """
        # Add a book
        ok, _ = add_book("Late Fee Book", "Auth", "1111111111111", 1)
        assert ok
    
        # Insert a borrow record with a due_date in the past by `late_days`
        today = datetime.now()
        borrow_date = today - timedelta(days=30)  # long enough
        due_date = today - timedelta(days=late_days)  # overdue by `late_days`
        db.insert_borrow_record("777777", 1, borrow_date, due_date)
    
        # Calculate fee
        res = calc_fee_for_book("777777", 1)
        # Allow both dict or tuple forms; project returns a number or dict with "fee"
>       fee = res.get("fee") if isinstance(res, dict) else float(res)
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r5_late_fee.py:40: TypeError
________________ test_r5_fee_formula_via_business_logic[3-1.5] ________________

late_days = 3, expected_fee = 1.5

    @pytest.mark.usefixtures("temp_db")
    @pytest.mark.parametrize("late_days, expected_fee", [
        (0, 0.0),
        (3, 0.5*3),            # first 7 days: $0.50/day
        (7, 0.5*7),            # = $3.50
        (10, 0.5*7 + 1.0*3),   # = $6.50
        (30, 15.0),            # cap at $15
    ])
    def test_r5_fee_formula_via_business_logic(late_days, expected_fee):
        """
        R5: Late fee rules:
          - Overdue after 14 days
          - First 7 overdue days: $0.50/day
          - Afterwards: $1.00/day
          - Cap per book: $15.00
        We simulate a borrow that is overdue by `late_days`.
        """
        # Add a book
        ok, _ = add_book("Late Fee Book", "Auth", "1111111111111", 1)
        assert ok
    
        # Insert a borrow record with a due_date in the past by `late_days`
        today = datetime.now()
        borrow_date = today - timedelta(days=30)  # long enough
        due_date = today - timedelta(days=late_days)  # overdue by `late_days`
        db.insert_borrow_record("777777", 1, borrow_date, due_date)
    
        # Calculate fee
        res = calc_fee_for_book("777777", 1)
        # Allow both dict or tuple forms; project returns a number or dict with "fee"
>       fee = res.get("fee") if isinstance(res, dict) else float(res)
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r5_late_fee.py:40: TypeError
________________ test_r5_fee_formula_via_business_logic[7-3.5] ________________

late_days = 7, expected_fee = 3.5

    @pytest.mark.usefixtures("temp_db")
    @pytest.mark.parametrize("late_days, expected_fee", [
        (0, 0.0),
        (3, 0.5*3),            # first 7 days: $0.50/day
        (7, 0.5*7),            # = $3.50
        (10, 0.5*7 + 1.0*3),   # = $6.50
        (30, 15.0),            # cap at $15
    ])
    def test_r5_fee_formula_via_business_logic(late_days, expected_fee):
        """
        R5: Late fee rules:
          - Overdue after 14 days
          - First 7 overdue days: $0.50/day
          - Afterwards: $1.00/day
          - Cap per book: $15.00
        We simulate a borrow that is overdue by `late_days`.
        """
        # Add a book
        ok, _ = add_book("Late Fee Book", "Auth", "1111111111111", 1)
        assert ok
    
        # Insert a borrow record with a due_date in the past by `late_days`
        today = datetime.now()
        borrow_date = today - timedelta(days=30)  # long enough
        due_date = today - timedelta(days=late_days)  # overdue by `late_days`
        db.insert_borrow_record("777777", 1, borrow_date, due_date)
    
        # Calculate fee
        res = calc_fee_for_book("777777", 1)
        # Allow both dict or tuple forms; project returns a number or dict with "fee"
>       fee = res.get("fee") if isinstance(res, dict) else float(res)
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r5_late_fee.py:40: TypeError
_______________ test_r5_fee_formula_via_business_logic[10-6.5] ________________

late_days = 10, expected_fee = 6.5

    @pytest.mark.usefixtures("temp_db")
    @pytest.mark.parametrize("late_days, expected_fee", [
        (0, 0.0),
        (3, 0.5*3),            # first 7 days: $0.50/day
        (7, 0.5*7),            # = $3.50
        (10, 0.5*7 + 1.0*3),   # = $6.50
        (30, 15.0),            # cap at $15
    ])
    def test_r5_fee_formula_via_business_logic(late_days, expected_fee):
        """
        R5: Late fee rules:
          - Overdue after 14 days
          - First 7 overdue days: $0.50/day
          - Afterwards: $1.00/day
          - Cap per book: $15.00
        We simulate a borrow that is overdue by `late_days`.
        """
        # Add a book
        ok, _ = add_book("Late Fee Book", "Auth", "1111111111111", 1)
        assert ok
    
        # Insert a borrow record with a due_date in the past by `late_days`
        today = datetime.now()
        borrow_date = today - timedelta(days=30)  # long enough
        due_date = today - timedelta(days=late_days)  # overdue by `late_days`
        db.insert_borrow_record("777777", 1, borrow_date, due_date)
    
        # Calculate fee
        res = calc_fee_for_book("777777", 1)
        # Allow both dict or tuple forms; project returns a number or dict with "fee"
>       fee = res.get("fee") if isinstance(res, dict) else float(res)
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r5_late_fee.py:40: TypeError
_______________ test_r5_fee_formula_via_business_logic[30-15.0] _______________

late_days = 30, expected_fee = 15.0

    @pytest.mark.usefixtures("temp_db")
    @pytest.mark.parametrize("late_days, expected_fee", [
        (0, 0.0),
        (3, 0.5*3),            # first 7 days: $0.50/day
        (7, 0.5*7),            # = $3.50
        (10, 0.5*7 + 1.0*3),   # = $6.50
        (30, 15.0),            # cap at $15
    ])
    def test_r5_fee_formula_via_business_logic(late_days, expected_fee):
        """
        R5: Late fee rules:
          - Overdue after 14 days
          - First 7 overdue days: $0.50/day
          - Afterwards: $1.00/day
          - Cap per book: $15.00
        We simulate a borrow that is overdue by `late_days`.
        """
        # Add a book
        ok, _ = add_book("Late Fee Book", "Auth", "1111111111111", 1)
        assert ok
    
        # Insert a borrow record with a due_date in the past by `late_days`
        today = datetime.now()
        borrow_date = today - timedelta(days=30)  # long enough
        due_date = today - timedelta(days=late_days)  # overdue by `late_days`
        db.insert_borrow_record("777777", 1, borrow_date, due_date)
    
        # Calculate fee
        res = calc_fee_for_book("777777", 1)
        # Allow both dict or tuple forms; project returns a number or dict with "fee"
>       fee = res.get("fee") if isinstance(res, dict) else float(res)
E       TypeError: float() argument must be a string or a real number, not 'NoneType'

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r5_late_fee.py:40: TypeError
________________ test_r6_title_case_insensitive_business_logic ________________

    @pytest.mark.usefixtures("temp_db")
    def test_r6_title_case_insensitive_business_logic():
        """
        R6 (business logic): case-insensitive title search should find matches.
        """
        ok, _ = add_book("Clean Architecture", "Robert C. Martin", "9780134494166", 2)
        assert ok
        r1 = search("clean", "title")
        r2 = search("CLEAN", "title")
        assert isinstance(r1, list) and isinstance(r2, list)
>       assert len(r1) >= 1 and len(r2) >= 1, "should return at least one match for sample title"
E       AssertionError: should return at least one match for sample title
E       assert (0 >= 1)
E        +  where 0 = len([])

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r6_search.py:18: AssertionError
___________________________ test_r6_api_json_search ___________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.mark.usefixtures("temp_db")
    def test_r6_api_json_search(client):
        """
        R6 (API): /api/search should return normalized JSON with 'results' and 'count'.
        """
        # Seed a predictable book
        add_book("Domain-Driven Design", "Eric Evans", "9780321125217", 1)
        resp = client.get("/api/search?q=domain&type=title")
        assert resp.status_code == 200
        data = resp.get_json()
        assert "results" in data and "count" in data
        assert isinstance(data["results"], list) and isinstance(data["count"], int)
>       assert data["count"] >= 1
E       assert 0 >= 1

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r6_search.py:32: AssertionError
____________________ test_r7_status_report_shape_and_keys _____________________

    @pytest.mark.usefixtures("temp_db")
    def test_r7_status_report_shape_and_keys():
        """
        R7: Patron status report should include the required keys.
        NOTE: If not implemented yet, this test will fail (which documents the gap).
        """
        report = get_status("123456")
        assert isinstance(report, dict), f"expected dict, got {type(report)}: {report}"
    
        # Required by the spec:
        for key in ["borrowed_books", "total_late_fees", "active_loans", "history"]:
>           assert key in report, f"missing key in status report: {key}"
E           AssertionError: missing key in status report: borrowed_books
E           assert 'borrowed_books' in {}

C:\Users\tedch\OneDrive\Desktop\25 F\CMPE 327 Software Quality Assurance\Assignment\assignment1\CISC327-CMPE327-F25-main\test\test_r7_patron_status.py:18: AssertionError
=========================== short test summary info ===========================
FAILED sample_test.py::test_add_book_valid_input - assert False == True
FAILED test/test_r3_borrow.py::test_r3_borrow_until_out_of_stock - AssertionE...
FAILED test/test_r4_return.py::test_r4_return_happy_path - AssertionError: re...
FAILED test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[0-0.0]
FAILED test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[3-1.5]
FAILED test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[7-3.5]
FAILED test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[10-6.5]
FAILED test/test_r5_late_fee.py::test_r5_fee_formula_via_business_logic[30-15.0]
FAILED test/test_r6_search.py::test_r6_title_case_insensitive_business_logic
FAILED test/test_r6_search.py::test_r6_api_json_search - assert 0 >= 1
FAILED test/test_r7_patron_status.py::test_r7_status_report_shape_and_keys - ...
======================== 11 failed, 5 passed in 0.48s =========================
